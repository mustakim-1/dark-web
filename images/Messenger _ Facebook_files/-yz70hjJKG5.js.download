;/*FB_PKG_DELIM*/

__d("MAWGetUnreadMsgsApi",["FBLogger","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAGlobals","WAJids","WAMsgType","qex"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getUnreadMsgs",function(a){return function(b,e,f){f===void 0&&(f=!1);return a.threads.get({jid:b}).then(function(g){if(g==null)return{type:"missing"};var k=c("qex")._("1354")?d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(a){if(a.length===0){c("FBLogger")("messenger_e2ee_web").warn("zero participants in thread");return null}return(a=a.find(function(a){return a.userJid===d("WAGlobals").getMyUserJid()}))==null?void 0:a.lastReadWatermarkTs}):d("MAWDbMsgTxns").maybeGetMsg(a,g.lastReadMsg).then(function(a){return a==null?null:d("MAWDbMsg").getSortOrderWithFallback(a)});return k.then(function(c){return c==null?{type:"none"}:d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getMsgsNeedingRetroactiveReadReceiptsUpTo(a,g.chatId,c,e),d("MAWDbMsgTxns").maybeGetMsg(a,g.lastReadMsgReceiptSent),d("MAWDbMsgTxns").getThreadOldestMessageBySortOrderOrCache(a,g)]).then(function(g){var k=g[0],l=g[1];g=g[2];var m=e-k.length,n=m>0&&(l==null||c>d("MAWDbMsg").getSortOrderWithFallback(l)),o=h(k,b,f),p=l==null;l=(l=l)!=null?l:g;return l==null||!n?k.length===0?{type:"none"}:i(k,o,b,e,c):j(a,d("MAWDbMsg").getSortOrderWithFallback(l),c,p,m,b,f).then(function(a){return i([].concat(k,a.nextMsgs),[].concat(o,a.unreadNextMsgs),b,e,c)})})})})}});function h(a,b,c){var e=[];a.forEach(function(a){var f=a.author,g=a.externalId,h=a.type;a=((a=(a=a.ephemeralSetting)==null?void 0:a.ephemeralExpirationInSec)!=null?a:0)>0;h=h!==d("WAMsgType").MSG_TYPE.CIPHERTEXT&&h!==d("WAMsgType").MSG_TYPE.UNAVAILABLE&&h!==d("WAMsgType").MSG_TYPE.FUTUREPROOF;!d("WAJids").isAuthorMe(f)&&!d("WAJids").isAuthorSystem(f)&&h&&(!c||a)&&e.push({author:f,chat:b,externalId:g})});return e}function i(a,b,c,e,f){if(a.length===0||b.length===0)return{type:"none"};var g=d("MAWDbMsg").getSortOrderWithFallback(a[a.length-1]),h=b[b.length-1];return{loadedUpTo:{author:h.author,chat:c,externalId:h.externalId},maybeMore:g<f&&a.length===e,type:"found",unreadMsgs:b}}function j(a,b,c,d,e,f,g){return a.messages.where(["threadJid","sortOrderMs"]).between([f,b],[f,c],d,!0).limit(e).toArray().then(function(i){var j=h(i,f,g);return j.length===0?a.messages.where(["threadJid","sortOrderMs"]).between([f,b],[f,c],d,!0).toArray().then(function(a){return{nextMsgs:a.slice(0,e),unreadNextMsgs:h(a,f,g).slice(0,e)}}):{nextMsgs:i,unreadNextMsgs:j}})}g.getUnreadMsgs=a}),98);
__d("MAWGetUnreadMsgsApi__DONOTUSE",["MAWDbMsgTxns","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getUnreadMsgs",function(a){return function(b,c,e){e===void 0&&(e=!1);return a.threads.get({jid:b}).then(function(f){if(f==null)return{type:"missing"};var g=d("MAWDbMsgTxns").maybeGetMsg(a,f.lastReadMsg);return g.then(function(g){if(f.lastReadMsg==null)return{type:"none"};var k=(g=g==null?void 0:g.msgId)!=null?g:f.lastReadMsg;return d("MAWDbMsgTxns").getMsgsNeedingRetroactiveReadReceiptsUpTo__DONOTUSE(a,f.chatId,k).then(function(d){var g=f.lastReadMsgReceiptSent,l=f.oldestMsg,m=c-d.length,n=m>0&&(g==null||k>g),o=h(d,b,e);if(l==null||!n)return d.length===0?{type:"none"}:i(d,o,b,c,k);n=g==null;g=(g=g)!=null?g:l;return j(a,g,k,n,m,b,e).then(function(a){return i([].concat(d,a.nextMsgs),[].concat(o,a.unreadNextMsgs),b,c,k)})})})})}});function h(a,b,c){var e=[];a.forEach(function(a){var f=a.author,g=a.externalId,h=a.type;a=((a=(a=a.ephemeralSetting)==null?void 0:a.ephemeralExpirationInSec)!=null?a:0)>0;h=h!==d("MAWMsgType").MSG_TYPE.CIPHERTEXT&&h!==d("MAWMsgType").MSG_TYPE.UNAVAILABLE&&h!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF;!d("WAJids").isAuthorMe(f)&&!d("WAJids").isAuthorSystem(f)&&h&&(!c||a)&&e.push({author:f,chat:b,externalId:g})});return e}function i(a,b,c,d,e){if(a.length===0||b.length===0)return{type:"none"};var f=a[a.length-1],g=b[b.length-1];return{loadedUpTo:{author:g.author,chat:c,externalId:g.externalId},maybeMore:f.msgId!==e&&a.length===d,type:"found",unreadMsgs:b}}function j(a,b,c,d,e,f,g){return a.messages.where("msgId").between(b,c,d,!0).limit(e).toArray().then(function(i){var j=h(i,f,g);return j.length===0?a.messages.where("msgId").between(b,c,d,!0).toArray().then(function(a){return{nextMsgs:a.slice(0,e),unreadNextMsgs:h(a,f,g).slice(0,e)}}):{nextMsgs:i,unreadNextMsgs:j}})}g.getUnreadMsgs__DONOTUSE=a}),98);
__d("MAWMarkReadReceiptsSentUpToApi",["MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWODSProxy","MAWTransactionMode","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markReadReceiptsSentUpTo",function(a){return function(b,c){i("success");return d("MAWDexieTable").dexieAll([a.threads.get({jid:b}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(b){var c=b[0],e=b[1];if(c==null){i("missingThread");return{type:"missing_thread"}}else if(e==null){i("invalidMsg");return{type:"invalid_msg"}}var f=d("MAWDbMsg").getSortOrderWithFallback(e);return(d("MAWDbMsgTxns").IS_SORT_ORDER_COMPARISON_ENABLED?d("MAWDbMsgTxns").clearRetroactiveReadReceiptStatusFromMsgsUpTo(a,c.chatId,f):d("MAWDbMsgTxns").clearRetroactiveReadReceiptStatusFromMsgsUpTo__DONOTUSE(a,c.chatId,e.msgId)).then(function(){if(e.threadJid!==c.jid){i("invalidMsg");return{type:"invalid_msg"}}var b=c.lastReadMsgReceiptSent;if(d("MAWDbMsgTxns").IS_SORT_ORDER_COMPARISON_ENABLED&&b!=null)return a.messages.get({msgId:b}).then(function(b){if(b!=null&&f<d("MAWDbMsg").getSortOrderWithFallback(b)){i("unchanged");return{type:"unchanged"}}return h(a,c,e.msgId)});if(!d("MAWDbMsgTxns").IS_SORT_ORDER_COMPARISON_ENABLED&&b!=null&&e.msgId<b){i("unchanged");return{type:"unchanged"}}return h(a,c,e.msgId)})})}});function h(a,b,c){return a.threads.put(babelHelpers["extends"]({},b,{lastReadMsgReceiptSent:c})).then(function(){i("updateLastReadMsgReceiptSent");return{type:"success"}})}function i(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.SEND_READ_RECEIPTS,key:a})}g.markReadReceiptsSentUpTo=a}),98);
__d("MAWMarkThreadAsReadUpToApi",["MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMarkThreadAsReadTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h={folder:null,isReadReceiptExpectedToBeSent:!1,type:"missing"};a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markThreadAsReadUpTo",function(a){return function(b,c){return a.threads.get({jid:b}).then(function(b){return b==null?h:d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageId(a,b),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b)]).then(function(c){var e=c[0];c=c[1];if(e==null||c==null)return h;var f=!0;return d("MAWMarkThreadAsReadTxns").markThreadAsReadUpToMsgSortOrderMs(a,b.jid,e,c,f).then(function(a){return babelHelpers["extends"]({},a,{folder:b.folder})})})})}});g.markThreadAsReadUpTo=a}),98);
__d("MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi",["MAWEphemeralMsgTxns","MAWIndexedDb","MAWLoggerUtils","MAWTransactionMode","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateEphemeralityOnMarkMsgsFromOtherAsRead ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY},"updateEphemeralityOnMarkMsgsFromOtherAsRead",function(a){return function(b,c){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnRead]).LOG(h(),b.map(function(a){return a.externalId}));b=b.map(function(a){return{msgId:a,ts:c}});return d("MAWEphemeralMsgTxns").bulkMarkEphemeralMessageAsRead(a,b)}});g.updateEphemeralityOnMarkMsgsFromOtherAsRead=a}),98);
__d("MWOneDbDualWriteHooksIgnore",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(){g=!0;return function(){g=!1}}function b(){return g}f.ignore=a;f.isIgnored=b}),66);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve().then(function(){return d("WASignalKeys").makeKeyPair()})}function c(a,c){return(h||(h=b("Promise"))).resolve().then(function(){return d("WACryptoPrimitives").scalarMult(d("WASignalOther").ensureSize(c,32),d("WASignalOther").ensureSize(a,32)).buffer})}e={generateIdentityKeyPair:a,calculateAgreement:c};g.calculateAgreement=c;g.CURVE25519_SIGNAL_DEPENDENCIES=e}),98);
__d("WACryptoEd25519",["WACryptoPrimitives","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){var b=h;h=[];try{return a()}finally{((a=h)!=null?a:[]).forEach(function(a){return void a.fill(0)});h=b}}function j(a,b){if(h==null)throw c("WAErr")("allocate called outside of active scope");return new a(b)}function a(a,b,c){d("WACryptoPrimitives").lowlevel.crypto_hash(a,b,c)}function b(a,b){for(var c=0;c<64;++c)b[c]=a[c],a[c]=0;l(a,b);b.fill(0)}function e(a,b){var c=[k(),k(),k(),k()];d("WACryptoPrimitives").lowlevel.scalarbase(c,b);R(a,c)}function k(a){var b=j(Float64Array,16);if(a){if(a.length>16)throw c("WAErr")("Incorrect initialiser array provided to the fieldElement");for(var d=0;d<a.length;d++)b[d]=a[d]}return b}function l(a,b){d("WACryptoPrimitives").lowlevel.modL(a,b)}var m=function(){return k([0])},n=function(){return k([1])},o=function(){return k([2])},p=function(){return k([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])};function q(){return[k(),k(),k(),k()]}function r(){return[k(),k(),k(),k()]}function s(){return[k(),k(),k()]}function t(a,b){var c=0;b=b;while(b>0){var d=b%65536;a[c]=d;b=(b-d)/65536;c++}}function u(a,b){return T(a,b)?0:1}function v(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=j(Uint8Array,32);b(c,a);return c[0]&1}function w(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=o(),g=k();c(g,b);e(a,f,g)}function x(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.A,g=m(),h=n(),i=k(),j=k(),l=k(),o=k();t(g,486662);c(i,b);e(j,g,b);f(l,i,j);f(o,l,h);e(a,b,o)}function y(a,b,c){c===1&&a.set(b)}var z=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function A(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.unpack25519,f=c.lowlevel.pow2523,g=c.lowlevel.M;c=c.lowlevel.S;var h=k();e(h,z);e=k();f(e,b);f=k();g(f,b,e);e=k();c(e,f);c=k();g(c,f,h);y(f,c,1^u(e,b));a.set(f)}function B(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.M,g=n(),h=k(),i=k(),j=k();c(h,b,g);e(i,b,g);S(j,i);f(a,h,j)}function C(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=m();c(a,e,b)}function D(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3])}function E(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3]);c(a[3],b[0],b[1])}function F(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.Z;c(a[0],b[0]);c(a[2],b[1]);w(a[3],b[2]);e(a[1],b[0],b[1]);b=k();c(b,a[1]);e(a[1],a[2],a[0]);f(a[2],a[2],a[0]);f(a[0],b,a[1]);f(a[3],a[3],a[2])}var G=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function H(a,b,c){var e=d("WACryptoPrimitives").lowlevel.unpack25519,f=d("WACryptoPrimitives").lowlevel.M,g=k();e(g,G);e=k();B(e,b);var h=k();x(h,b);var i=k();A(i,h);h=k();f(h,b,g);b=k();S(b,i);g=k();f(g,h,b);i=k();C(i,g);y(g,i,v(g)^c);a[0].set(g);a[1].set(e);a[2].set(n());f(a[3],a[0],a[1])}function I(a,b){a[0].set(b[0]),a[1].set(b[1]),a[2].set(b[2])}function J(a,b){var c=s();I(c,b);F(a,c)}function K(a,b){var c=r(),d=s();J(c,b);D(d,c);F(c,d);D(d,c);F(c,d);E(a,c)}function L(a){var b,c=(b=d("WACryptoPrimitives")).lowlevel.S,e=b.lowlevel.M,f=b.lowlevel.pow2523;b=b.lowlevel.pack25519;var g=k(),h=k(),i=k(),j=k(),l=k();f(g,a);c(h,g);c(i,h);e(j,i,a);e(l,j,a);f=new Uint8Array(32);b(f,l);return 1&f[31]}function M(a,b){C(a[0],b[0]),a[1].set(b[1]),a[2].set(b[2]),C(a[3],b[3])}function f(a,b){var c=q();b=U(c,b);if(b!==0)return-1;M(a,c);return 0}function N(a,b){var c=d("WACryptoPrimitives").lowlevel.M,e=d("WACryptoPrimitives").lowlevel.A;b=b;var f=n(),g=m();t(g,486662);var h=k();w(h,b);b=k();e(b,h,f);h=k();S(h,b);f=k();c(f,h,g);b=k();C(b,f);c=k();x(c,b);h=L(c);f=k([0]);y(f,g,h);c=k();e(c,b,f);g=k();C(g,c);y(c,g,h);a.set(c)}function O(a){var b=d("WACryptoPrimitives").lowlevel.unpack25519;a=d("WACryptoPrimitives").hash(a);var c=(a[31]&128)>>7;a[31]&=127;var e=k();b(e,a);b=k();P(b,e);a=q();H(a,b,c);e=q();K(e,a);return e}function P(a,b){return i(function(){return N(a,b)})}function Q(a){return i(function(){return O(a)})}function R(a,b){var c=k(),e=k(),f=k(),g=d("WACryptoPrimitives").lowlevel.M,h=d("WACryptoPrimitives").lowlevel.pack25519;S(f,b[2]);g(c,b[0],f);g(e,b[1],f);h(a,e);g=new Uint8Array(32);h(g,c);a[31]^=(g[0]&1)<<7}function S(a,b){var c=k();c.set(b);var e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.S;for(var g=253;g>=0;--g)f(c,c),g!==2&&g!==4&&e(c,c,b);a.set(c)}function T(a,b){var c=d("WACryptoPrimitives").lowlevel.pack25519,e=d("WACryptoPrimitives").lowlevel.crypto_verify_32,f=new Uint8Array(32),g=new Uint8Array(32);c(f,a);c(g,b);return e(f,0,g,0)}function U(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.set25519,f=c.lowlevel.S,g=c.lowlevel.M,h=c.lowlevel.Z,i=c.lowlevel.A,j=c.lowlevel.D,l=c.lowlevel.unpack25519;c=c.lowlevel.pow2523;var o=k(),q=k(),r=k(),s=k(),t=k(),u=k(),v=k();e(a[2],n());l(a[1],b);f(r,a[1]);g(s,r,j);h(r,r,a[2]);i(s,a[2],s);f(t,s);f(u,t);g(v,u,t);g(o,v,r);g(o,o,s);c(o,o);g(o,o,r);g(o,o,s);g(o,o,s);g(a[0],o,s);f(q,a[0]);g(q,q,s);T(q,r)&&g(a[0],a[0],p());f(q,a[0]);g(q,q,s);if(T(q,r))return-1;V(a[0])===b[31]>>7&&h(a[0],m(),a[0]);g(a[3],a[0],a[1]);return 0}function V(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=new Uint8Array(32);b(c,a);return c[0]&1}g.runInAllocationScope=i;g.allocate=j;g.hashSha512=a;g.reduce=b;g.scalarmultBase=e;g.fieldElement=k;g.modL=l;g.p3Element=q;g.unpack=f;g.elligator=P;g.hashToPoint=Q;g.pack=R;g.inv25519=S;g.unpackneg=U}),98);
__d("WASignalSignatures",["Promise","WACryptoDependencies","WACryptoEd25519","WACryptoPrimitives","WAErr","WAHex","WALogger","WALongInt","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeSignedPreKey error ",""]);i=function(){return a};return a}function j(a,b,c){return d("WACryptoEd25519").runInAllocationScope(function(){var e,f=b.length,g=a.privateKey,h=new Uint8Array(32);(e=d("WACryptoEd25519")).scalarmultBase(h,g);var i=h[31]&128,j=new Uint8Array(f+128);j[0]=254;j.fill(255,1,32);j.set(g,32);j.set(b,64);j.set(c,f+64);var k=e.allocate(Uint8Array,64);e.hashSha512(k,j,f+128);j.set(h,32);h=e.allocate(Float64Array,64);e.reduce(k,h);e.scalarmultBase(j,k);var l=e.allocate(Uint8Array,64);e.hashSha512(l,j,f+64);e.reduce(l,h);for(f=0;f<32;++f)h[f]=k[f];for(f=0;f<32;++f)for(k=0;k<32;++k)h[f+k]+=l[f]*g[k];e.modL(j.subarray(32,64),h);return{pubKeyNegative:i!==0,signedMsg:j}})}function a(a,c){return(h||(h=b("Promise"))).resolve().then(function(){var b=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(b);return k(a,c,b)})}function e(a,b,c){var e=c[63];return e&96?!1:d("WACryptoEd25519").runInAllocationScope(function(){var f,g,h=(f=d("WACryptoPrimitives")).lowlevel.A,i=f.lowlevel.M,j=f.lowlevel.Z,k=f.lowlevel.pack25519,l=f.lowlevel.unpack25519,m=(g=d("WACryptoEd25519")).allocate(Uint8Array,64);m.set(c);m[63]=e&127;var n=g.fieldElement(),o=g.fieldElement(),p=g.fieldElement(),q=g.fieldElement(),r=g.fieldElement(),s=g.allocate(Uint8Array,32),t=g.fieldElement();t[0]=1;l(n,a.subarray(1));j(o,n,t);h(p,n,t);g.inv25519(q,p);i(r,o,q);k(s,r);s[31]=s[31]&127|e&128;return f.signDetachedVerify(b,m,s)})}function k(a,b,c){a=j(a,b,c);b=d("WASignalOther").sliceBytes(a.signedMsg,0,64);b[63]=b[63]&127|(a.pubKeyNegative?128:0);return b}function l(a,b,e){var f=d("WASignalKeys").makeKeyPair(),g=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(g);e=k(e,d("WASignalKeys").serializePubKey(f),g);if(!Number.isSafeInteger(b))throw c("WAErr")("Expected timestamp to be a safe integer, given "+String(b));return{id:d("WASignalKeys").castToPreKeyId(a),ts:b,keyPair:f,signature:e}}function f(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);return k(a,b,c)}function m(a){var b=a.id,c=a.keyPair;return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:b,publicKey:d("WASignalKeys").serializePubKey(c),privateKey:c.privateKey,signature:a.signature,timestamp:a.ts})}function n(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey,e=a.privateKey,f=a.signature;a=a.timestamp;return b==null||c==null||e==null||f==null||a==null?null:{id:d("WASignalKeys").castToSignedPreKeyId(b),ts:d("WALongInt").numberOrThrowIfTooLarge(a),keyPair:d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalOther").toBytes(e,32),d("WASignalKeys").castToSerializedPubKey(new Uint8Array(c))),signature:d("WASignalOther").toBytes(f,64)}}catch(a){d("WALogger").DEV(i(),a);return null}}function o(a){return new Uint8Array(d("WAHex").parseHex(a))}function p(a){if(a.length===33)return d("WASignalKeys").castToSerializedPubKey(a);else if(a.length===32)return d("WASignalKeys").serializeIdentity(a);else throw c("WAErr")("verifyCertificate publicKey incorrect length")}function q(a,c,d){return(h||(h=b("Promise"))).resolve().then(function(){var b=l(a,c,d),e=m(b);return{plainObject:b,record:e}})}g.signMsg=a;g.verifyMsgSignalVariant=e;g.makeSignature=k;g.makeSignedPreKey=l;g.signSenderKeyMessage=f;g.serializeSignedPreKeyForPrivateStorage=m;g.deserializeSignedPreKey=n;g.convertPublicKeyHexToUint8Array=o;g.convertPublicKeyToSerializedPubKey=p;g.generateSignedPreKey=q}),98);