;/*FB_PKG_DELIM*/

__d("LSIssueAttachmentsRangeQuery",["LSGetCursor","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetCursor"),c.i64.cast([0,1])).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.db.table(17).fetch([[[a[0],a[1]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[2]=c.i64.cast([0,1]):(e=b.item,d[7]=e.syncGroup,c.i64.neq(d[7],void 0)?d[6]=d[7]:d[6]=c.i64.cast([0,1]),d[2]=d[6])})},function(e){return d[4]=new c.Map(),d[4].set("thread_key",a[0]),d[4].set("media_group",a[1]),d[4].set("max_timestamp_ms",c.i64.cast([2328,1316134911])),d[4].set("cursor",d[0]),d[4].set("sync_group",d[2]),d[4].set("last_loaded_message_id",void 0),d[5]=c.toJSON(d[4]),c.storedProcedure(b("LSIssueNewTask"),"arq",c.i64.cast([0,105]),d[5],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):(f=e.item,f.hasMoreBefore?c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[2]=c.i64.cast([0,1]):(e=b.item,d[7]=e.syncGroup,c.i64.neq(d[7],void 0)?d[6]=d[7]:d[6]=c.i64.cast([0,1]),d[2]=d[6])})},function(e){return d[4]=new c.Map(),d[4].set("thread_key",a[0]),d[4].set("media_group",a[1]),d[4].set("max_timestamp_ms",f.minTimestampMs),d[4].set("cursor",d[0]),d[4].set("sync_group",d[2]),d[4].set("last_loaded_message_id",void 0),d[5]=c.toJSON(d[4]),c.storedProcedure(b("LSIssueNewTask"),"arq",c.i64.cast([0,105]),d[5],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.resolve())})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSIssueAttachmentsRangeQueryStoredProcedure",["LSIssueAttachmentsRangeQuery","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.mediaGroup;return c("LSIssueAttachmentsRangeQuery").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWSharedAttachmentsSectionHooks",["I64","LSIntEnum","LSThreadMediaGalleryGroup","MessagingAttachmentType","ReQL","ReQLSuspense","gkx","react","usePrevious","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=k||d("react"),m=l.useCallback,n=l.useEffect,o=l.useState;function a(a,b,d,e,f){var g=o(!1),h=g[0],i=g[1],j=a.length,k=(g=c("usePrevious")(j))!=null?g:0,l=c("usePrevious")(b),p=(a=c("usePrevious")(h))!=null?a:!1;n(function(){d==null&&f!==!0&&(e(),c("gkx")("736")&&i(!0))},[d,e,f]);n(function(){var a=k!==j,f=l===!0&&!b||c("gkx")("736")&&d==null&&b===!1&&l===!1&&k===j;h&&(f||a)?i(!1):c("gkx")("736")&&k===j&&b&&h&&p===!0&&e()},[j,b,h,k,l,d,e,p]);g=m(function(){if(!h){e();return i(!0)}},[h,e,i]);a=j>0||!h&&!b;return[h,g,a]}function p(a,b,e,g){var j;g=g===void 0?{}:g;g=g.removeUnsentMessages;var k=g===void 0?!1:g,l=(h||(h=c("useReStore")))();g=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableDescending(l.tables.attachments_ranges_v2__generated).getKeyRange(a).filter(function(a){return(i||(i=d("I64"))).equal(a.mediaGroup,b)})},[l,a,b],f.id+":114");var n=g==null?void 0:g.minTimestampMs;j=c("gkx")("736")?g==null?void 0:g.hasMoreBefore:(j=g==null?void 0:g.hasMoreBefore)!=null?j:!1;var o=m(function(a){if(!e(a))return null;if(!k)return a;var b=d("ReQLSuspense").first(d("ReQL").fromTableAscending(l.tables.messages.index("messageId")).getKeyRange(a.messageId),f.id+":135");return b==null||b.isUnsent?null:a},[l,e,k]),p=d("ReQLSuspense").useArray(function(){var b=d("ReQL").fromTableDescending(l.tables.attachments.index("fk_messages")).getKeyRange(a);return b.map(o).filter(Boolean)},[l,a,o],f.id+":148");return[p,g,n,j]}function q(a){var b=a.attachmentType;a=a.defaultCtaType;return(i||(i=d("I64"))).equal(b,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))?a==="xma_web_url":!1}function b(a,b){a=p(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSThreadMediaGalleryGroup").LINKS),q,b);b=a[0];var e=a[1],f=a[2];a=a[3];return[b,j.ofNumber(c("LSThreadMediaGalleryGroup").LINKS),e,f,a]}function r(a){a=a.attachmentType;return(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))||(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))}function e(a,b){a=p(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),r,b);b=a[0];var e=a[1],f=a[2];a=a[3];return[b,j.ofNumber(c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),e,f,a]}function s(a){a=a.attachmentType;return(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE))}function t(a,b){a=p(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSThreadMediaGalleryGroup").FILES_ONLY),s,b);b=a[0];var e=a[1],f=a[2];a=a[3];return[b,j.ofNumber(c("LSThreadMediaGalleryGroup").FILES_ONLY),e,f,a]}g.useLoader=a;g.useQueryLinkAttachments=b;g.useQueryMediaAttachments=e;g.useQueryFileAttachments=t}),98);
__d("MWXIconCalendar",["MWXSvgIcon","SVGIcon","cr:9031","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:9031")),c("gkx")("23219"));g["default"]=a}),98);
__d("useLoadMoreThreadSharedAttachments.react",["Int64Hooks","LSFactory","LSIssueAttachmentsRangeQueryStoredProcedure","MAWThreadCutover","MWThreadKey.react","gkx","promiseDone","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=c("useAsyncReStore")(),e=d("MWThreadKey.react").useMWThreadKeyMemoizedExn(),g=d("MAWThreadCutover").useGetCutoverOpenThreadKey(e);return d("Int64Hooks").useCallbackInt64(function(){c("promiseDone")(b,function(b){return b.runInTransaction(function(b){return c("LSIssueAttachmentsRangeQueryStoredProcedure")(c("LSFactory")(b),{mediaGroup:a,threadKey:g&&c("gkx")("736")?g:e})},"readwrite",void 0,void 0,f.id+":33")})},[b,a,g,e])}g["default"]=a}),98);
__d("useMAWLoadMoreThreadSharedAttachments",["I64","MAWBridgeSendAndReceive","MAWMiActOnActThreadReady","gkx","promiseDone","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(i||d("react")).useCallback,l=(j||(j=d("I64"))).of_string("9999999999999");function a(a,b,e,f){var g=(h||(h=c("useReStore")))(),i=k(function(){return b!=null&&b&&e!=null?c("gkx")("736")?(j||(j=d("I64"))).to_float(e):(j||(j=d("I64"))).to_int32(e):c("gkx")("736")?Number.MAX_SAFE_INTEGER:(j||(j=d("I64"))).to_int32(l)},[b,e]);return k(function(){a!=null&&c("promiseDone")(d("MAWMiActOnActThreadReady").onActThreadReady(g.tables,a,"useMAWLoadMoreThreadSharedAttachments",function(a,b,c){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","loadMoreMedia",{earliestLoadedMediaMessageId:f,earliestLoadedMediaTs:i(),threadJid:c})}))},[a,g.tables,f,i])}g["default"]=a}),98);
__d("useMAWLoadMoreCutoverThreadSharedAttachments",["MAWDbMsg","MWSharedAttachmentsSectionHooks","useLoadMoreThreadSharedAttachments.react","useMAWLoadMoreThreadSharedAttachments"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e,f=d("MWSharedAttachmentsSectionHooks").useQueryMediaAttachments(a),g=f[0],h=f[1],i=f[2],j=f[3];f=f[4];e=(e=f)!=null?e:!0;var k=(i==null?void 0:i.lastLoadedMessageId)!=null?d("MAWDbMsg").toMsgId(i==null?void 0:i.lastLoadedMessageId):void 0;f=c("useMAWLoadMoreThreadSharedAttachments")(a,f,j,(a=k)!=null?a:void 0);j=d("MWSharedAttachmentsSectionHooks").useQueryMediaAttachments(b);k=j[0];a=j[2];b=j[4];b=(j=b)!=null?j:!1;j=c("useLoadMoreThreadSharedAttachments.react")(h);h=d("MWSharedAttachmentsSectionHooks").useLoader(g,e,i,f);i=h[0];f=h[1];h=h[2];a=d("MWSharedAttachmentsSectionHooks").useLoader(k,b,a,j,e);j=a[0];var l=a[1];a=a[2];if(e||i)return{attachments:g,completedFirstLoad:h,hasMore:e,isLoadingMore:i,onLoadMore:f};else if(b||j)return{attachments:g.concat(k),completedFirstLoad:a,hasMore:b,isLoadingMore:j,onLoadMore:l};else return{attachments:g.concat(k),completedFirstLoad:!0,hasMore:!1,isLoadingMore:!1,onLoadMore:function(){}}}g["default"]=a}),98);