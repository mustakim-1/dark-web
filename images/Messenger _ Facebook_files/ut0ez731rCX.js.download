;/*FB_PKG_DELIM*/

__d("E2EEBackupCommon",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["ALREADY_REGISTERED","BACKUP_KEY_PAIR_SERIALIZATION_ERROR","CLIENT_PARAMS_ERROR","NETWORK_PROVIDER_ERROR","NOT_REGISTERED","VESTA_CLIENT_ERROR","VESTA_SERVER_ERROR","ISLAND_PUB_RSA_KEY_INVALID","ISLAND_PUB_ED25519_KEY_INVALID","MISSING_PIN_INPUT","GENERAL_ERROR","INVALID_PASSWORD"]);c=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;d=a.call(this,c==null?void 0:c.message)||this;d.name="BackupError";d.errorType=b;d.detailedError=c;d.message=b+((c==null?void 0:c.message)!=null?": "+(c==null?void 0:c.message):"");return d}return b}(babelHelpers.wrapNativeSuper(Error));f.BackupErrorType=a;f.BackupError=c}),66);
__d("VestaClientBootstrap",["FBLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Array(32).fill(void 0);i.push(void 0,null,!0,!1);function j(a,b){return a[b]}var k=i.length;function l(a){if(a<36)return;i[a]=k;k=a}function m(a){var b=j(i,a);l(a);return b}function n(a){k===i.length&&i.push(i.length+1);var b=k;k=j(i,b);i[b]=a;return b}function o(a){return a}var p=new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});p.decode();var q=null;function r(){var a=o(h.memory);(q===null||q.buffer!==a.buffer)&&(q=new Uint8Array(a.buffer));return q}function s(a,b){return p.decode(r().subarray(a,a+b))}function t(a,b){try{return a.apply(void 0,b)}catch(b){a=o(h.__wbindgen_exn_store);a(n(b))}}function u(a,b){return r().subarray(a/1,a/1+b)}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(typeof WebAssembly.instantiateStreaming==="function")return WebAssembly.instantiateStreaming(a,b);a=(yield a.arrayBuffer());return WebAssembly.instantiate(a,b)});return w.apply(this,arguments)}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=arguments,e={wbg:{__wbg_buffer_de1150f91b23aa89:function(a){return n(j(i,a).buffer)},__wbg_call_4573f605ca4b5f10:function(){return t(function(a,b){a=j(i,a).call(j(i,b));return n(a)},d)},__wbg_crypto_98fc271021c7d2ad:function(a){return n(j(i,a).crypto)},__wbg_getRandomValues_98117e9a7e993920:function(){return t(function(a,b){j(i,a).getRandomValues(j(i,b))},arguments)},__wbg_global_8c35aeee4ac77f2b:function(){return t(function(){var b=a.global;return n(b)},d)},__wbg_globalThis_56d9c9f814daeeee:function(){return t(function(){return n(window)},d)},__wbg_length_e09c0b925ab8de5d:function(a){return j(i,a).length},__wbg_modulerequire_3440a4bcf44437db:function(){return t(function(a,b){a=f.require(s(a,b));return n(a)},d)},__wbg_msCrypto_a2cdb043d2bfe57f:function(a){return n(j(i,a).msCrypto)},__wbg_new_97cf52648830a70d:function(a){return n(new Uint8Array(j(i,a)))},__wbg_newnoargs_fc5356289219b93b:function(a,b){a=new Function(s(a,b));return n(a)},__wbg_newwithlength_e833b89f9db02732:function(a){return n(new Uint8Array(a>>>0))},__wbg_node_4b517d861cbcb3bc:function(a){return n(j(i,a).node)},__wbg_process_2f24d6544ea7b200:function(a){return n(j(i,a).process)},__wbg_randomFillSync_64cc7d048f228ca8:function(){return t(function(a,b,c){j(i,a).randomFillSync(u(b,c))},d)},__wbg_self_ba1ddafe9ea7a3a2:function(){return t(function(){var a=self.self;return n(a)},d)},__wbg_set_a0172b213e2469e9:function(a,b,c){return j(i,a).set(j(i,b),c>>>0)},__wbg_subarray_9482ae5cd5cd99d3:function(a,b,c){return n(j(i,a).subarray(b>>>0,c>>>0))},__wbg_versions_6164651e75405d4a:function(a){return n(j(i,a).versions)},__wbg_window_be3cc430364fd32c:function(){return t(function(){var a=window.window;return n(a)},d)},__wbindgen_is_object:function(a){return typeof j(i,a)==="object"&&j(i,a)!==null},__wbindgen_is_string:function(a){return typeof j(i,a)==="string"},__wbindgen_is_undefined:function(a){return j(i,a)===void 0},__wbindgen_memory:function(){return n(h.memory)},__wbindgen_object_clone_ref:function(a){return n(j(i,a))},__wbindgen_object_drop_ref:m,__wbindgen_throw:function(a,b){throw c("FBLogger")("wasm_vesta_client").mustfixThrow(s(a,b))}}},g=(yield window.fetch(b)),k=(yield v(yield g,e)),l=k.instance;h=l.exports;x.__wbindgen_wasm_module=f;return l});return y.apply(this,arguments)}g["default"]=x}),98);
__d("VestaClient",["$InternalEnum","Promise","VestaClientBootstrap","asyncToGeneratorRuntime","bx","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("mapVestaClientError").__setRef("VestaClient"),j=4096,k,l,m=function(a){return new(h||(h=b("Promise")))(function(b){i.onReady(function(c){b(c(a))})})};function n(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("VestaClientBootstrap")(c("bx").getURL(c("bx")("604"))));k=a.exports;l=p(k.memory)});return o.apply(this,arguments)}function p(a){return a}function a(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){(k===void 0||l===void 0)&&(yield n());var c=0,d=new Uint8Array(l.buffer,c,a.byteLength);d.set(a);c+=d.byteLength;a=new Uint8Array(l.buffer,c,b.byteLength);a.set(b);c+=a.byteLength;b=new Uint8Array(l.buffer,c,j);var e=p(k.vesta_client_validate_hsm_key);e=e(d.byteOffset,d.byteLength,a.byteOffset,a.byteLength,b.byteOffset,b.byteLength);if(e!==0)throw yield m(e);d=new DataView(l.buffer,c,j);a=z(d);return a[0][0]!==0});return q.apply(this,arguments)}function d(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){(k===void 0||l===void 0)&&(yield n());var b=0,c=new Uint8Array(l.buffer,b,a.byteLength);c.set(a);b+=c.byteLength;a=new Uint8Array(l.buffer,b,j);var d=p(k.vesta_client_begin_register);d=d(c.byteOffset,c.byteLength,a.byteOffset,a.byteLength);if(d!==0)throw yield m(d);c=new DataView(l.buffer,b,j);a=z(c);return{clientState:new Uint8Array(a[1]),r1Message:new Uint8Array(a[0])}});return r.apply(this,arguments)}var s=b("$InternalEnum").Mirrored(["WaBackupKeyData","Raw"]);function e(a,b,c,d,e,f,g,h,i,j){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e,f,g,h,i,o){i===void 0&&(i=0);o===void 0&&(o=s.WaBackupKeyData);(k===void 0||l===void 0)&&(yield n());var q=0,r=new Uint8Array(l.buffer,q,a.byteLength);r.set(a);q+=a.byteLength;a=new Uint8Array(l.buffer,q,b.byteLength);a.set(b);q+=b.byteLength;b=new Uint8Array(l.buffer,q,c.byteLength);b.set(c);q+=c.byteLength;c=new Uint8Array(l.buffer,q,d.byteLength);c.set(d);q+=d.byteLength;d=new Uint8Array(l.buffer,q,e.byteLength);d.set(e);q+=e.byteLength;e=new Uint8Array(l.buffer,q,f.byteLength);e.set(f);q+=f.byteLength;f=new Uint8Array(l.buffer,q,g.byteLength);f.set(g);q+=g.byteLength;g=new Uint8Array(l.buffer,q,h.byteLength);g.set(h);q+=h.byteLength;h=new Uint8Array(l.buffer,q,j);if(o===s.Raw){o=p(k.vesta_client_finish_register);o=o(r.byteOffset,r.byteLength,a.byteOffset,a.byteLength,b.byteOffset,b.byteLength,c.byteOffset,c.byteLength,d.byteOffset,d.byteLength,e.byteOffset,e.byteLength,f.byteOffset,f.byteLength,g.byteOffset,g.byteLength,i,h.byteOffset,h.byteLength)}else{var t=p(k.vesta_client_finish_register_proto);o=t(r.byteOffset,r.byteLength,a.byteOffset,a.byteLength,b.byteOffset,b.byteLength,c.byteOffset,c.byteLength,d.byteOffset,d.byteLength,e.byteOffset,e.byteLength,f.byteOffset,f.byteLength,g.byteOffset,g.byteLength,i,h.byteOffset,h.byteLength)}if(o!==0)throw yield m(o);t=new DataView(l.buffer,q,j);r=z(t);return{registerIdentifier:new Uint8Array(r[1]),registerPayload:new Uint8Array(r[0])}});return t.apply(this,arguments)}function f(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){(k===void 0||l===void 0)&&(yield n());var b=0,c=new Uint8Array(l.buffer,b,a.byteLength);c.set(a);b+=c.byteLength;a=new Uint8Array(l.buffer,b,j);var d=p(k.vesta_client_begin_login);d=d(c.byteOffset,c.byteLength,a.byteOffset,a.byteLength);if(d!==0)throw yield m(d);c=new DataView(l.buffer,b,j);a=z(c);return{clientState:new Uint8Array(a[1]),l1Message:new Uint8Array(a[0])}});return u.apply(this,arguments)}function v(a,b,c,d){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){(k===void 0||l===void 0)&&(yield n());var e=0,f=new Uint8Array(l.buffer,e,a.byteLength);f.set(a);e+=a.byteLength;a=new Uint8Array(l.buffer,e,b.byteLength);a.set(b);e+=b.byteLength;b=new Uint8Array(l.buffer,e,c.byteLength);b.set(c);e+=c.byteLength;c=new Uint8Array(l.buffer,e,d.byteLength);c.set(d);e+=d.byteLength;d=new Uint8Array(l.buffer,e,j);var g=p(k.vesta_client_finish_login);g=g(f.byteOffset,f.byteLength,a.byteOffset,a.byteLength,b.byteOffset,b.byteLength,c.byteOffset,c.byteLength,d.byteOffset,d.byteLength);if(g!==0)throw yield m(g);f=new DataView(l.buffer,e,j);a=z(f);return{exportKey:new Uint8Array(a[2]),l3Message:new Uint8Array(a[0]),sessionKey:new Uint8Array(a[1])}});return w.apply(this,arguments)}function x(a,b,c,d){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){d===void 0&&(d=s.WaBackupKeyData);(k===void 0||l===void 0)&&(yield n());var e=0,f=new Uint8Array(l.buffer,e,a.byteLength);f.set(a);e+=a.byteLength;a=new Uint8Array(l.buffer,e,b.byteLength);a.set(b);e+=b.byteLength;b=new Uint8Array(l.buffer,e,c.byteLength);b.set(c);e+=c.byteLength;c=new Uint8Array(l.buffer,e,j);if(d===s.Raw){d=p(k.vesta_client_unpack_login_payload);d=d(f.byteOffset,f.byteLength,a.byteOffset,a.byteLength,b.byteOffset,b.byteLength,c.byteOffset,c.byteLength)}else{var g=p(k.vesta_client_unpack_login_payload_proto);d=g(f.byteOffset,f.byteLength,a.byteOffset,a.byteLength,b.byteOffset,b.byteLength,c.byteOffset,c.byteLength)}if(d!==0)throw yield m(d);g=new DataView(l.buffer,e,j);f=z(g);return{userSecret:new Uint8Array(f[0])}});return y.apply(this,arguments)}function z(a){var b=[],c=0,d=a.getUint8(c++);for(var e=0;e<d;e++){var f=a.getUint32(c);c+=4;b[e]=[];for(var g=0;g<f;g++)b[e].push(a.getUint8(c++))}return b}g.validateHsmKey=a;g.beginRegister=d;g.SerializationMode=s;g.finishRegister=e;g.beginLogin=f;g.finishLogin=v;g.unpackLoginPayload=x}),98);
__d("VestaClientError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f["default"]=a}),66);
__d("E2EEBackupSecretRestoreModule",["E2EEBackupCommon","Promise","QuickPerformanceLogger","VestaClient","VestaClientError","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("qpl")._(235874858,"168");function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){(i||(i=c("QuickPerformanceLogger"))).markerStart(j);i.markerAnnotate(j,{string:{product_use_case:e.productUseCase}});try{var g=(yield a.initLogin({clientId:e.clientId,productUseCase:e.productUseCase},f)),k=g.islandRsaPub,l=g.islandRsaPubSig,m=g.islandEd25519Pub,n=g.islandEd25519PubSig;g=g.isRegistered;(i||(i=c("QuickPerformanceLogger"))).markerPoint(j,"init_login_network_call");if(!g){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"NOT_REGISTERED"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NOT_REGISTERED)}g=(yield (h||(h=b("Promise"))).all([d("VestaClient").validateHsmKey(k,l),d("VestaClient").validateHsmKey(m,n)]));k=g[0];l=g[1];if(!k){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"ISLAND_PUB_RSA_KEY_INVALID"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_RSA_KEY_INVALID)}if(!l){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"ISLAND_PUB_ED25519_KEY_INVALID"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_ED25519_KEY_INVALID)}i.markerPoint(j,"verify_island_rsa_key");i.markerPoint(j,"verify_island_ed25519_key");n=e.vestaAccountPin;if(n==null)throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.MISSING_PIN_INPUT);else{g=new TextEncoder();k=(yield d("VestaClient").beginLogin(g.encode(n)));l=k.clientState;g=k.l1Message;(i||(i=c("QuickPerformanceLogger"))).markerPoint(j,"begin_login_vesta_client");n=(yield a.beginLogin({clientId:e.clientId,productUseCase:e.productUseCase,opaqueL1:g},f));k=n.opaqueL2;g=n.opaqueL2Sig;i.markerPoint(j,"begin_login_network_call");n=(yield d("VestaClient").finishLogin(k,g,m,l));k=n.exportKey;g=n.l3Message;m=n.sessionKey;i.markerPoint(j,"finish_login_vesta_client");l=(yield a.finishLogin({clientId:e.clientId,productUseCase:e.productUseCase,opaqueL3:g},f));n=l.loginSuccess;a=l.loginPayload;i.markerPoint(j,"finish_login_network_call");if(!n){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"VESTA_SERVER_ERROR"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}if(a!=null){e=(yield d("VestaClient").unpackLoginPayload(a,m,k));g=e.userSecret;(i||(i=c("QuickPerformanceLogger"))).markerPoint(j,"unpack_login_payload");i.markerEnd(j,2);return g}i.markerAnnotate(j,{string:{failure_reason:"VESTA_SERVER_ERROR"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}}catch(a){if(a instanceof d("E2EEBackupCommon").BackupError)throw a;else if(a instanceof c("VestaClientError")){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"VestaClientException: "+a.name}});i.markerEnd(j,3);if(a.name==="InvalidUserPassword")throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.INVALID_PASSWORD,a);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_CLIENT_ERROR,a)}else{(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:a.message}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NETWORK_PROVIDER_ERROR,a)}}});return k.apply(this,arguments)}g.restoreBackupSecret=a}),98);
__d("E2EEBackupUtil",["tweetnacl-util"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("tweetnacl-util").encodeBase64(a).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function b(a){var b=a.replace(/-/g,"+").replace(/_/g,"/");a=a.length%4;if(a>0){if(a===1)throw new Error("Invalid length, couldn't decode input string");b=b.padEnd(b.length+(4-a),"=")}return c("tweetnacl-util").decodeBase64(b)}g.encodeBase64Url=a;g.decodeBase64Url=b}),98);
__d("GaloisField32",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h=c("FBLogger")("labyrinth_web"),i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,5,7,1,3,13,15,9,11,21,23,17,19,29,31,25,27,0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,21,22,19,16,25,26,31,28,13,14,11,8,1,2,7,4,0,4,8,12,16,20,24,28,5,1,13,9,21,17,29,25,10,14,2,6,26,30,18,22,15,11,7,3,31,27,23,19,0,5,10,15,20,17,30,27,13,8,7,2,25,28,19,22,26,31,16,21,14,11,4,1,23,18,29,24,3,6,9,12,0,6,12,10,24,30,20,18,21,19,25,31,13,11,1,7,15,9,3,5,23,17,27,29,26,28,22,16,2,4,14,8,0,7,14,9,28,27,18,21,29,26,19,20,1,6,15,8,31,24,17,22,3,4,13,10,2,5,12,11,30,25,16,23,0,8,16,24,5,13,21,29,10,2,26,18,15,7,31,23,20,28,4,12,17,25,1,9,30,22,14,6,27,19,11,3,0,9,18,27,1,8,19,26,2,11,16,25,3,10,17,24,4,13,22,31,5,12,23,30,6,15,20,29,7,14,21,28,0,10,20,30,13,7,25,19,26,16,14,4,23,29,3,9,17,27,5,15,28,22,8,2,11,1,31,21,6,12,18,24,0,11,22,29,9,2,31,20,18,25,4,15,27,16,13,6,1,10,23,28,8,3,30,21,19,24,5,14,26,17,12,7,0,12,24,20,21,25,13,1,15,3,23,27,26,22,2,14,30,18,6,10,11,7,19,31,17,29,9,5,4,8,28,16,0,13,26,23,17,28,11,6,7,10,29,16,22,27,12,1,14,3,20,25,31,18,5,8,9,4,19,30,24,21,2,15,0,14,28,18,29,19,1,15,31,17,3,13,2,12,30,16,27,21,7,9,6,8,26,20,4,10,24,22,25,23,5,11,0,15,30,17,25,22,7,8,23,24,9,6,14,1,16,31,11,4,21,26,18,29,12,3,28,19,2,13,5,10,27,20,0,16,5,21,10,26,15,31,20,4,17,1,30,14,27,11,13,29,8,24,7,23,2,18,25,9,28,12,19,3,22,6,0,17,7,22,14,31,9,24,28,13,27,10,18,3,21,4,29,12,26,11,19,2,20,5,1,16,6,23,15,30,8,25,0,18,1,19,2,16,3,17,4,22,5,23,6,20,7,21,8,26,9,27,10,24,11,25,12,30,13,31,14,28,15,29,0,19,3,16,6,21,5,22,12,31,15,28,10,25,9,26,24,11,27,8,30,13,29,14,20,7,23,4,18,1,17,2,0,20,13,25,26,14,23,3,17,5,28,8,11,31,6,18,7,19,10,30,29,9,16,4,22,2,27,15,12,24,1,21,0,21,15,26,30,11,17,4,25,12,22,3,7,18,8,29,23,2,24,13,9,28,6,19,14,27,1,20,16,5,31,10,0,22,9,31,18,4,27,13,1,23,8,30,19,5,26,12,2,20,11,29,16,6,25,15,3,21,10,28,17,7,24,14,0,23,11,28,22,1,29,10,9,30,2,21,31,8,20,3,18,5,25,14,4,19,15,24,27,12,16,7,13,26,6,17,0,24,21,13,15,23,26,2,30,6,11,19,17,9,4,28,25,1,12,20,22,14,3,27,7,31,18,10,8,16,29,5,0,25,23,14,11,18,28,5,22,15,1,24,29,4,10,19,9,16,30,7,2,27,21,12,31,6,8,17,20,13,3,26,0,26,17,11,7,29,22,12,14,20,31,5,9,19,24,2,28,6,13,23,27,1,10,16,18,8,3,25,21,15,4,30,0,27,19,8,3,24,16,11,6,29,21,14,5,30,22,13,12,23,31,4,15,20,28,7,10,17,25,2,9,18,26,1,0,28,29,1,31,3,2,30,27,7,6,26,4,24,25,5,19,15,14,18,12,16,17,13,8,20,21,9,23,11,10,22,0,29,31,2,27,6,4,25,19,14,12,17,8,21,23,10,3,30,28,1,24,5,7,26,16,13,15,18,11,22,20,9,0,30,25,7,23,9,14,16,11,21,18,12,28,2,5,27,22,8,15,17,1,31,24,6,29,3,4,26,10,20,19,13,0,31,27,4,19,12,8,23,3,28,24,7,16,15,11,20,6,25,29,2,21,10,14,17,5,26,30,1,22,9,13,18],j=[0,1,18,28,9,23,14,12,22,4,25,16,7,15,6,13,11,24,2,29,30,26,8,5,17,10,21,31,3,19,20,27],k="ACDEFHJKLMNPQRSTUVWXYZ0123456789",l=function(){var a={};for(var b=0;b<k.length;b++)a[k[b]]=b;return a}();function m(a,b){return i[a*32+b]}function a(a){var b=[];for(var c=0;c<a.length;c++){if(!(a[c]in l)){h.mustfix("gf32: tried to convert invalid string to GF32 matrix: %s",a);return null}b[c]=l[a[c]]}return b}function b(a){var b=[];for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;b.push(k[e])}return b.join("")}function n(a){return a===0||a===1||a===2||a===3||a===4||a===5||a===6||a===7||a===8||a===9||a===10||a===11||a===12||a===13||a===14||a===15||a===16||a===17||a===18||a===19||a===20||a===21||a===22||a===23||a===24||a===25||a===26||a===27||a===28||a===29||a===30||a===31?a:null}function d(a){var b=[];for(var c=0;c<a.length;c++){var d=n(a[c]);if(d==null)throw h.mustfixThrow("gf32: tried to convert bad value to GF32 element: %s",a[c]);b.push(d)}return b}function o(a,b){var c=a^b,d=n(c);if(d==null)throw h.mustfixThrow("gf32: xor of gf32 elements returned a non-element (should be impossible): %s ^ %s = %s",a,b,c);return d}function p(a,b,c,d,e){for(var f=0;f<b;f++)a[c*b+f]=o(a[c*b+f],m(a[d*b+f],e))}function q(a,b,c,d){for(var e=0;e<b;e++){var f=a[c*b+e];a[c*b+e]=a[d*b+e];a[d*b+e]=f}}function r(a,b,c,d){for(var e=0;e<b;e++)a[c*b+e]=m(a[c*b+e],d)}function s(a,b){if(b===0)throw h.mustfixThrow("gf32: tried to divide by 0");return m(a,j[b])}function t(a){var b=Array(a*a).fill(0);for(var c=0;c<a;c++)b[c*a+c]=1;return b}function e(a,b){a=a.slice();var c=t(b);for(var d=0;d<b;d++){var e=d;if(a[d*b+e]===0){var f=!1;for(var g=d+1;g<b;g++)if(a[g*b+e]!==0){q(a,b,d,g);q(c,b,d,g);f=!0;break}if(!f)return null}for(g=d+1;g<b;g++){f=s(a[g*b+e],a[d*b+e]);p(a,b,g,d,f);p(c,b,g,d,f)}}for(f=b-1;f>=0;f--){e=f;for(g=f-1;g>=0;g--){d=s(a[g*b+e],a[f*b+e]);p(a,b,g,f,d);p(c,b,g,f,d)}}for(d=0;d<b;d++){e=a[d*b+d];if(e===0)return null;r(c,b,d,j[e])}return c}f=0;g.zero=f;g.matrixToSymbols=b;g.symbolsToMatrix=a;g.invert=e;g.xor=o;g.multiply=m;g.asGf32MatExn=d}),98);
__d("GF32RecoveryCodes",["FBLogger","GaloisField32"],(function(a,b,c,d,e,f,g){"use strict";var h=c("FBLogger")("labyrinth_web"),i=34,j=4,k=3,l=i+j,m=d("GaloisField32").asGf32MatExn([18,24,16,12,8,20,2,19,4,22,21,5,28,5,14,21,7,16,15,10,3,9,28,22,11,30,19,6,7,7,9,18,16,2,9,12,18,14,7,6,5,16,9,24,16,28,19,2,14,8,2,4,1,21,26,21,10,27,16,25,18,14,20,17,11,22,21,22,16,20,2,5,0,9,6,7,23,23,23,11,6,5,3,31,29,30,17,28,0,30,28,7,13,5,11,22,12,16,25,3,20,22,26,22,14,29,5,14,5,19,12,19,18,8,25,7,30,7,8,12,0,26,15,10,17,21,2,29,14,4,31,7,29,6,29,1,14,16,17,15,4,16,7,4,7,4,8,26,10,23,24,26]);function n(a,b,c){c===void 0&&(c=1);var d=[];for(a=a;a<b;a+=c)d.push(a);return d}var o={};function p(a,b){function c(a,b,d,e){if(b<=0)return[[]];if(e-d<=b)return[n(d,e)];var f=a|b<<8|d<<16|e<<24,g=o[f];if(g!=null)return g;var h=[];c(a-1,b-1,d+1,e).forEach(function(a){a=a.slice();a.splice(0,0,d);h.push(a)});c(a-1,b,d+1,e).forEach(function(a){h.push(a.slice())});o[f]=h;return h}return c(a,b,0,a)}function q(a,b){var c=a.length,d=Array(c*c).fill(0),e=0;for(var f=0;f<j;f++){if(f===b)continue;for(var g=0;g<c;g++){var h=a[g];d[e*c+g]=m[f*l+h]}e++}return d}function r(a,b){for(var c=0;c<j;c++){var e=q(a,c);e=d("GaloisField32").invert(e,b);if(e!=null)return{excludeRow:c,submatInv:e}}return null}function a(a){var b=Array(j).fill(0);for(var c=0;c<j;c++)for(var e=0;e<i;e++)b[c]=d("GaloisField32").xor(b[c],d("GaloisField32").multiply(m[c*l+e],a[e]));e=Array(j*j);for(a=0;a<j;a++)for(c=0;c<j;c++)e[a*j+c]=m[a*l+i+c];c=d("GaloisField32").invert(e,j);if(c==null)throw h.mustfixThrow("gf32: failed to invert error code submatrix (should be impossible): %s",JSON.stringify(e));a=Array(j).fill(0);for(e=0;e<j;e++)for(var f=0;f<j;f++)a[e]=d("GaloisField32").xor(a[e],d("GaloisField32").multiply(c[e*j+f],b[f]));return a}function b(a){var b=new Set(),c=d("GaloisField32").symbolsToMatrix(a);if(c==null){h.warn("gf32: recovery code %s could not be converted to GF32 matrix",a);return[a]}a=Array(j).fill(0);for(var e=0;e<j;e++)for(var f=0;f<l;f++)a[e]=d("GaloisField32").xor(a[e],d("GaloisField32").multiply(m[e*l+f],c[f]));f=p(l,k);for(var e=f,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(f){if(g>=e.length)break;i=e[g++]}else{g=e.next();if(g.done)break;i=g.value}i=i;var n=a.slice();for(var o=0;o<j;o++)for(var q=i,s=Array.isArray(q),t=0,q=s?q:q[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var u;if(s){if(t>=q.length)break;u=q[t++]}else{t=q.next();if(t.done)break;u=t.value}u=u;n[o]=d("GaloisField32").xor(n[o],d("GaloisField32").multiply(m[o*l+u],c[u]))}u=r(i,k);if(u==null){h.warn("gf32: no submat inverse found for error locs %s",JSON.stringify(i));continue}t=u.excludeRow;s=u.submatInv;q=Array(k).fill(0);o=n.slice();o.splice(t,1);for(u=0;u<k;u++)for(var v=0;v<k;v++)q[u]=d("GaloisField32").xor(q[u],d("GaloisField32").multiply(s[u*k+v],o[v]));v=d("GaloisField32").zero;for(u=0;u<k;u++)v=d("GaloisField32").xor(v,d("GaloisField32").multiply(m[t*l+i[u]],q[u]));if(v===n[t]){s=c.slice();for(o=0;o<i.length;o++)s[i[o]]=q[o];b.add(d("GaloisField32").matrixToSymbols(s))}}return Array.from(b)}g.getEccForCode=a;g.getCandidateCodes=b}),98);
__d("LSHandleWrongRecoveryCode",["LSAppendDataTraceAddon","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] Beginning execution."),c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1415]),c.i64.cast([0,2]),a[1],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[9],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,3])})},function(e){return a[2]?c.sequence([function(e){return a[2]?c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,84]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}]):a[0]!==void 0?c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),"The flow did not succeed",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[9],c.i64.cast([0,3]))):c.resolve()}]):a[1]!==void 0?c.sequence([function(e){return d[8]=["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",a[1]].join(""),function(a){c.logger(a).mustfix(a)}(d[8]),d[7]=c.createArray(),a[0]!==void 0?d[9]=(d[7].push(a[0]),d[7]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",a[1],d[7],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[0]!==void 0?c.sequence([function(e){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),d[8],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[13],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[0]!==void 0?c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[9],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("checkLSRecoveryCodeMatch",["LSBinaryToHex.nop","LSShape","LSVec","Promise","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e,f,g,i){i=c("LSVec").toArray(i).map(function(a){return d("LSShape").toRecord(a)});var j=c("LSBinaryToHex.nop")(a,e,c("nullthrows")(f)),k=function(d,i){return d.then(function(d){if(d[0]!=null)return(h||(h=b("Promise"))).resolve(d);d=c("LSBinaryToHex.nop")(a,e,i.virtual_device_id);return(h||(h=b("Promise"))).all([j,d]).then(function(a){var c=a[0],d=a[1];a=c.length===d.length&&c.every(function(a,b){return a===d[b]});if(a)return(h||(h=b("Promise"))).resolve([f,g]);else return(h||(h=b("Promise"))).resolve([void 0,void 0])})})};return i.reduce(k,(h||(h=b("Promise"))).resolve([void 0,void 0]))}g["default"]=a}),98);
__d("deriveLSKey",["I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f,g){g=g==="1"?(h||(h=d("I64"))).of_string("8"):(h||(h=d("I64"))).of_string("16");g=c("LSVec").ofArray([g,(h||(h=d("I64"))).of_string("32")]);return c("LSCreateDerivedKeys.nop")(a,b,d("LSCryptoUtils").strToBuf(f),void 0,d("LSCryptoUtils").strToBuf(e),g).then(function(a){a=a[0];if(a==null)return[void 0,void 0];a=c("LSVec").toArray(a);return a.length===2?[a[0],a[1]]:[void 0,void 0]})}g["default"]=a}),98);
__d("parseLSRecoveryCode",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=a.substring(0,1);if(a.length!==40||c!=="1"&&c!=="2")return;var d=c==="1"?35:34,e=a.substring(1,2);a=a.substring(2,d+2);d="BackupRecoveryCode_v"+c+"_"+e+"_"+b;return[a,d,c]}f["default"]=a}),66);
__d("LSParseRecoveryCode_v2.nop",["CryptoLogger","GF32RecoveryCodes","Promise","checkLSRecoveryCodeMatch","deriveLSKey","parseLSRecoveryCode"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("parse_recovery_code_v2");f=c("parseLSRecoveryCode")(f,g);if(f!=null)return c("deriveLSKey")(a,e,f[0],f[1],f[2]);else{i&&j.mustfix("could not parse recovery code with uid");return(h||(h=b("Promise"))).resolve([void 0,void 0])}}var j=new Map([["B","8"],["G","C"],["I","1"],["O","0"]]),k=new RegExp("["+Array.from(j.keys()).join("")+"]","g");function l(a){return a.replace(k,function(a){return j.get(a)||a})}a=function(a,e,f,g,j){if(f.length!==40)return(h||(h=b("Promise"))).resolve([void 0,void 0]);var k=f.substring(0,2),m=l(f.substring(2,40));f=d("GF32RecoveryCodes").getCandidateCodes(m);var n=function(d,f){return d.then(function(d){if(d[0]!=null)return(h||(h=b("Promise"))).resolve(d);else return i(a,e,k+f,g,!1).then(function(d){var f=d[0];if(f==null)return(h||(h=b("Promise"))).resolve([void 0,void 0]);else return c("checkLSRecoveryCodeMatch")(a,e,f,d[1],j)}).then(function(a){if(a[0]==null)return[void 0,void 0];else return a})})};return f.reduce(n,(h||(h=b("Promise"))).resolve([void 0,void 0])).then(function(c){return c[0]==null?i(a,e,k+m,g,!0):(h||(h=b("Promise"))).resolve(c)})};g["default"]=a}),98);
__d("LSAddDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSFlushDataTrace.nop","LSGetViewerFBID","LSHandleWrongRecoveryCode","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSParseRecoveryCode_v2.nop","gkx","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Beginning execution."),(c("gkx")("23657")||c("gkx")("26375"))&&c("justknobx")._("946")?d.sequence([function(c){return d.i64.eq(a[3],d.i64.cast([0,2]))?e[8]=d.i64.cast([0,199]):e[8]=d.i64.cast([0,71]),a[4]!==void 0?d.sequence([function(c){return d.sequence([function(a){return e[16]="EncryptedBackups Trace ID",e[17]=d.i64.to_string(e[8]),e[15]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[15],e[16],e[15],e[17]].join("")),d.resolve()},function(c){return d.storedProcedure(b("LSCreateDataTrace"),a[4],void 0,void 0,"backup_init_flow",e[8])}])},function(b){return e[9]=a[4]}]):d.sequence([function(a){return d.sequence([function(a){return d.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[16]=a[0],a})},function(a){return d.sequence([function(a){return e[20]="EncryptedBackups MCD Trace ID",e[21]=d.i64.to_string(e[8]),e[19]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[19],e[20],e[19],e[21]].join("")),d.resolve()},function(a){return d.storedProcedure(b("LSCreateDataTrace"),e[16],void 0,void 0,"backup_init_flow",e[8])}])},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[17]=a[0],a})},function(a){return e[17]?e[18]=!0:e[18]=!1,e[18]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[19]=d.createArray(),void 0!==void 0?e[20]=(e[19].push(void 0),e[19]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[19],d.i64.cast([0,3]))):d.resolve()},function(a){return e[15]=e[16]}])},function(a){return e[9]=e[15]}])},function(a){return d.sequence([function(a){return e[9]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[9],d.i64.cast([0,1413]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[15]=a[0],a})},function(a){return e[15]?e[16]=!0:e[16]=!1,e[16]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[17]=d.createArray(),void 0!==void 0?e[18]=(e[17].push(void 0),e[17]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[17],d.i64.cast([0,3]))):d.resolve()}])},function(a){return e[10]=d.createArray(),d.forEach(d.db.table(179).fetch(),function(a){var b=a.item;return d.sequence([function(a){return e[17]=b.taskId,d.db.table(2).fetch([[[e[17]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?e[15]=!1:(a.item,e[15]=!0)})},function(a){return e[15]?0:e[18]=(e[10].push(e[17]),e[10])}])})},function(a){return e[11]=d.i64.of_int32(e[10].length),d.i64.gt(e[11],d.i64.cast([0,0]))?d.loopAsync(e[11],function(a){return e[15]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[10],e[15]).then(function(a){return a=a,e[16]=a[0],e[17]=a[1],a})},function(a){return d.forEach(d.db.table(179).fetch([[[e[16]]]]),function(a){return a["delete"]()})}])}):d.resolve()},function(a){return d.db.table(179).fetch().next().then(function(a,b){b=a.done;a=a.value;return b?e[12]=!1:(a.item,e[12]=!0)})},function(c){return e[12]?d.sequence([function(a){return e[15]="Aborting addDevice execution as there is an existing pending task",e[15]!==void 0?d.sequence([function(a){return e[17]=["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",e[15]].join(""),function(a){d.logger(a).mustfix(a)}(e[17]),e[16]=d.createArray(),e[9]!==void 0?e[18]=(e[16].push(e[9]),e[16]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",e[15],e[16],d.i64.cast([0,3]))},function(a){return d.sequence([function(a){return e[9]!==void 0?d.sequence([function(a){return e[9]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[9],d.i64.cast([0,85]),d.i64.cast([0,2]),e[17],void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[20]=a[0],a})},function(a){return e[20]?e[21]=!0:e[21]=!1,e[21]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[22]=d.createArray(),void 0!==void 0?e[23]=(e[22].push(void 0),e[22]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[22],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[9]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),e[9]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[18]=a[0],a})},function(a){return e[18]?e[19]=!0:e[19]=!1,e[19]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[20]=d.createArray(),void 0!==void 0?e[21]=(e[20].push(void 0),e[20]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[20],d.i64.cast([0,3]))):d.resolve()}])}]):d.sequence([function(a){return e[9]!==void 0?d.sequence([function(a){return e[9]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[9],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",""].join(""),void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[18]=a[0],a})},function(a){return e[18]?e[19]=!0:e[19]=!1,e[19]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[20]=d.createArray(),void 0!==void 0?e[21]=(e[20].push(void 0),e[20]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[20],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[9]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),e[9]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[16]?e[17]=!0:e[17]=!1,e[17]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[18]=d.createArray(),void 0!==void 0?e[19]=(e[18].push(void 0),e[18]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[18],d.i64.cast([0,3]))):d.resolve()}])},function(a){return e[14]=d.i64.cast([0,1])}]):d.sequence([function(b){return e[15]=d.createArray(),d.forEach(d.filter(d.db.table(184).fetch(),function(b){return d.i64.eq(b.backupId,a[0])}),function(a){a=a.item;return e[21]=new d.Map(),e[21].set("virtual_device_id",a.virtualDeviceId),e[22]=(e[15].push(e[21]),e[15])})},function(a){return d.db.table(172).fetch().next().then(function(a,b){var c=a.done;a=a.value;return c?e[16]=void 0:(b=a.item,e[22]=b.encryptionManagementDelegatorId,d.i64.neq(e[22],void 0)?(d.i64.neq(e[22],d.i64.cast([0,0]))?e[23]=d.i64.to_string(e[22]):e[23]=void 0,e[21]=e[23]):e[21]=void 0,e[16]=e[21])})},function(a){return d.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,e[18]=a[0],a})},function(c){return d.nativeOperation(b("LSParseRecoveryCode_v2.nop"),a[1],e[16]==null?d.i64.to_string(e[18]):e[16],e[15]).then(function(a){return a=a,e[19]=a[0],e[20]=a[1],a})},function(c){return d.blobs.neq(e[19],void 0)?d.blobs.neq(e[20],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[19]).then(function(a){return a=a,e[21]=a[0],a})},function(a){return d.db.table(178).put({pk:d.i64.cast([0,1]),recoveryCodeStatus:d.i64.cast([0,1])})},function(c){return e[22]=d.i64.cast([0,0]),e[23]=new d.Map(),e[23].set("backup_id",a[0]),e[23].set("virtual_device_id",e[21]==null?"":e[21]),e[23].set("trace_id",e[9]),e[24]=d.toJSON(e[23]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50007]),e[24],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),e[9],e[22]).then(function(a){return a=a,e[25]=a[0],a})},function(b){return d.db.table(185).add({pk:d.i64.cast([0,1]),backupId:a[0],deviceRegistrationId:a[2],taskId:e[25]})},function(a){return d.db.table(179).add({taskId:e[25],virtualDeviceId:e[19],blobDecryptionKey:e[20]})}]):d.storedProcedure(b("LSHandleWrongRecoveryCode"),e[9],"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Wrong recovery code. blob_decryption_key is null",!0):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Wrong recovery code"),e[21]=d.createArray(),void 0!==void 0?e[22]=(e[21].push(void 0),e[21]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure","Wrong recovery code",e[21],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),e[9],"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Wrong recovery code. virtual_device_id is null",!0)}])},function(a){return e[14]=d.i64.cast([0,0])}])},function(a){return e[1]=e[14]}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] addDeviceFlow is not enabled"),e[1]=d.i64.cast([0,1])))},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[1]}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSAddDeviceStoredProcedure",["LSAddDevice","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.backupId;d[1]=b.recoveryCode;d[2]=b.deviceRegistrationId;d[3]=b.backupTenancy;d[4]=b.traceId;return c("LSAddDevice").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSEncryptedBackupsOpStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,FAILURE:1,UNKNOWN:2});f["default"]=a}),66);
__d("LSEncryptedBackupsRecoveryCodeStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({OPTIMISTIC:1,VALID:2,INVALID:3,SYSTEM_ERROR:4});f["default"]=a}),66);
__d("LSGetEncryptionVersionFromSupportedVersionsList",["I64","LSResult","LSVec","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){if(b.length>0&&!(i||(i=d("I64"))).gt(a,b[0]))return b[0];else return a}function k(a,b){if(b.length>0&&(i||(i=d("I64"))).gt(a,b[0]))return b[0];else return a}function l(a,b){return a.filter(function(a){return b.reduce(function(b,c){return b||(i||(i=d("I64"))).equal(c,a)},!1)})}function m(a){a=a;var b=(i||(i=d("I64"))).zero;while(a.length>0){var c=a.reduce(l,a[0]);if(c.length>0)return c.sort(function(a,b){return(i||(i=d("I64"))).compare(b,a)})[0];b=a.reduce(k,(i||(i=d("I64"))).max_int);c=[];a=a.reduce(function(a,c){c=c.filter(function(a){return(i||(i=d("I64"))).gt(a,b)});return c.length>0?a.concat([c]):a},c);if(a.length>0)continue;return b}return b}function a(a,e,f){a=c("LSVec").toArray(f).map(function(a){return c("LSVec").toArray(a)});var g=a.reduce(j,(i||(i=d("I64"))).zero);e=a.map(function(a){return a.filter(function(a){return(i||(i=d("I64"))).ge(a,g)})}).filter(function(a){return a.length>0});return(h||(h=b("Promise"))).resolve(c("LSResult")(m(e)))}g.call=a}),98);
__d("LSGetEncryptionVersionFromSupportedVersionsList.nop",["LSGetEncryptionVersionFromSupportedVersionsList"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("LSGetEncryptionVersionFromSupportedVersionsList").call(a,b,c)};g["default"]=a}),98);
__d("MAWEncryptedBackupsClearRecoveryCode",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=b("Promise"))).all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_recovery_code_data)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_recovery_code_status))]).then(function(c){var d=c[0],e=c[1];if(d!=null||e!=null)return a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([(d==null?void 0:d.taskId)!=null?a.secure_recovery_code_data["delete"](d.taskId):(h||(h=b("Promise"))).resolve(),(e==null?void 0:e.pk)!=null?a.secure_encrypted_backups_recovery_code_status["delete"](e.pk):(h||(h=b("Promise"))).resolve()])},"readwrite",void 0,void 0,f.id+":27")})}g.encryptedBackupsClearRecoveryCode=a}),98);
__d("MWChatEncryptedBackupsSettingsDialogQuery.graphql",["MWChatEncryptedBackupsSettingsDialogQuery_facebookRelayOperation","relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:!1,kind:"LocalArgument",name:"isEBWebPreImprovementsEnabled"},{defaultValue:!1,kind:"LocalArgument",name:"soapEncryptedBackupEnabled"}],c={alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},d={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},f={alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[e],storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"MWChatEncryptedBackupsSettingsDialogQuery",selections:[{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWChatEncryptedBackupsVestaUserInfo_vestaGetUserInfoResponse"}],storageKey:null}],storageKey:null}],storageKey:null},action:"THROW",path:"viewer"},{args:[{kind:"Variable",name:"isEBWebPreImprovementsEnabled",variableName:"isEBWebPreImprovementsEnabled"},{kind:"Variable",name:"soapEncryptedBackupEnabled",variableName:"soapEncryptedBackupEnabled"}],kind:"FragmentSpread",name:"MWChatEncryptedBackupsSettingsDialogStep_query"},{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[c,{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"MWChatEncryptedBackupsSettingsDialogQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_timeout_remaining_secs",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"last_sync_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_creation_time",storageKey:null},d,c,{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},d],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"logout_whitelist",storageKey:null},{condition:"isEBWebPreImprovementsEnabled",kind:"Condition",passingValue:!0,selections:[f,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]}],storageKey:null}]},{condition:"isEBWebPreImprovementsEnabled",kind:"Condition",passingValue:!1,selections:[f]},{condition:"soapEncryptedBackupEnabled",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:[e,{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_backup_encryption_management_delegator_id",storageKey:null}],type:"User",abstractKey:null},d],storageKey:null}],storageKey:null}]}]},params:{id:b("MWChatEncryptedBackupsSettingsDialogQuery_facebookRelayOperation"),metadata:{},name:"MWChatEncryptedBackupsSettingsDialogQuery",operationKind:"query",text:null}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("MWEncryptedBackupsRecoveryCodeStatus",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.onFailure,e=a.onInvalidRecoveryCode,f=a.onSuccess;a=a.recoveryCodeStatusData;if((a==null?void 0:a.length)!==1)return;a=a[0].recoveryCodeStatus;switch((h||(h=d("I64"))).to_int32(a)){case c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC:return c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC;case c("LSEncryptedBackupsRecoveryCodeStatus").INVALID:e==null?void 0:e();return c("LSEncryptedBackupsRecoveryCodeStatus").INVALID;case c("LSEncryptedBackupsRecoveryCodeStatus").VALID:f==null?void 0:f();return c("LSEncryptedBackupsRecoveryCodeStatus").VALID;case c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR:b==null?void 0:b();return c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR;default:b==null?void 0:b(),c("FBLogger")("labyrinth_web").mustfix("Invalid Recovery Code Status type")}}g.encryptedBackupsGetRecoveryCodeStatus=a}),98);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="4901700173259892"}),null);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql",["VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"begin_login_request",variableName:"input"}],concreteType:"VestaBeginLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_begin_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2_sig",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderBeginLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="5072170542843500"}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql",["VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"finish_login_request",variableName:"input"}],concreteType:"VestaFinishLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_finish_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_login_payload",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderFinishLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7267509326655323"}),null);
__d("VestaServerGraphQLLoginProviderInitQuery.graphql",["VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"request"}],c=[{alias:null,args:[{kind:"Variable",name:"vesta_init_request",variableName:"request"}],concreteType:"VestaInitIqResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_login_init",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderInitQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderInitQuery",selections:c},params:{id:b("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderInitQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProvider",["E2EEBackupUtil","Promise","RelayHooks","RelayModern","VestaServerGraphQLLoginProviderBeginLoginMutation.graphql","VestaServerGraphQLLoginProviderFinishLoginMutation.graphql","VestaServerGraphQLLoginProviderInitQuery.graphql","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=c.environment;c=(yield d("RelayHooks").fetchQuery(c,h!==void 0?h:h=b("VestaServerGraphQLLoginProviderInitQuery.graphql"),{request:{fbid:a.clientId,product_use_case:a.productUseCase,vesta_client_api_version:6}}).toPromise());a=c==null?void 0:c.fbid_based_auth_layer_vesta_login_init;c=a==null?void 0:a.base64url_encoded_island_rsa_pub;var e=a==null?void 0:a.base64url_encoded_island_rsa_pub_signature,f=a==null?void 0:a.base64url_encoded_opaque_pub,g=a==null?void 0:a.base64url_encoded_opaque_pub_signature,i=a==null?void 0:a.base64url_encoded_island_ed25519_pub,j=a==null?void 0:a.base64url_encoded_island_ed25519_pub_signature,k=a==null?void 0:a.is_registered;a=a==null?void 0:a.attempts_remaining;if(c!=null&&e!=null&&f!=null&&g!=null&&i!=null&&j!=null&&k!=null){var l;return{islandRsaPub:(l=d("E2EEBackupUtil")).decodeBase64Url(c),islandRsaPubSig:l.decodeBase64Url(e),opaquePub:l.decodeBase64Url(f),opaquePubSig:l.decodeBase64Url(g),islandEd25519Pub:l.decodeBase64Url(i),islandEd25519PubSig:l.decodeBase64Url(j),isRegistered:k,loginAttemptsRemaining:a}}throw new Error("GraphQL Response is Null")});return l.apply(this,arguments)}function c(a,c){var e=c.environment,f=i!==void 0?i:i=b("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql"),g={input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l1:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL1)}};return new(k||(k=b("Promise")))(function(a,b){d("RelayModern").commitMutation(e,{mutation:f,variables:g,onCompleted:function(c){c=c.fbid_based_auth_layer_vesta_begin_login;var e=c==null?void 0:c.base64url_encoded_opaque_l2;c=c==null?void 0:c.base64url_encoded_opaque_l2_sig;if(e!=null&&c!=null){a({opaqueL2:d("E2EEBackupUtil").decodeBase64Url(e),opaqueL2Sig:d("E2EEBackupUtil").decodeBase64Url(c)});return}b(new Error("GraphQL Response is Null"))},onError:function(a){b(a)}})})}function e(a,c){var e=c.environment,f=c.updater;return new(k||(k=b("Promise")))(function(c,g){d("RelayModern").commitMutation(e,{mutation:j!==void 0?j:j=b("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql"),variables:{input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l3:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL3)}},onCompleted:function(a){a=a.fbid_based_auth_layer_vesta_finish_login;var b=a==null?void 0:a.base64url_encoded_login_payload,e=a==null?void 0:a.login_success;a=a==null?void 0:a.attempts_remaining;if(e!=null){c({loginSuccess:e,loginPayload:b==null?b:d("E2EEBackupUtil").decodeBase64Url(b),attemptsRemaining:a});return}g(new Error("GraphQL Response is Null"))},onError:function(a){g(a)},updater:f})})}g.initLogin=a;g.beginLogin=c;g.finishLogin=e}),98);
__d("mapVestaClientError",["VestaClientError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case 1:return new h();case 2:return new i();case 3:return new j();case 4:return new k();case 5:return new l();case 6:return new m();case 7:return new n();case 8:return new o();case 9:return new p();case 10:return new q();case 11:return new r();case 12:return new s();default:return new t()}}var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Buffer supplied to WASM for response is too small");a=b.call(this,a)||this;a.name="InsufficientResultBuffer";return a}return a}(b=c("VestaClientError")),i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Incorrect user password supplied during login");a=b.call(this,a)||this;a.name="InvalidUserPassword";return a}return a}(b),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Invalid input from server");a=b.call(this,a)||this;a.name="MalformedServerResponse";return a}return a}(b),k=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Invalid input from client");a=b.call(this,a)||this;a.name="MalformedClientInput";return a}return a}(b),l=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Error during encryption operation");a=b.call(this,a)||this;a.name="EncryptionFailure";return a}return a}(b),m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Error during decryption operation");a=b.call(this,a)||this;a.name="DecryptionFailure";return a}return a}(b),n=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Error during serialization operation.");a=b.call(this,a)||this;a.name="SerializationFailure";return a}return a}(b),o=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Error deserializing inputs, likely due to malformed input");a=b.call(this,a)||this;a.name="DeserializationFailure";return a}return a}(b),p=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Passed RSA public key is in an invalid format.");a=b.call(this,a)||this;a.name="RsaInvalidKey";return a}return a}(b),q=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Unable to verify RSA signature");a=b.call(this,a)||this;a.name="RsaVerificationFailure";return a}return a}(b),r=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Passed Ed25519 public key is in an invalid format.");a=b.call(this,a)||this;a.name="Ed25519InvalidKey";return a}return a}(b),s=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Unable to verify Ed25519 signature");a=b.call(this,a)||this;a.name="Ed25519VerificationFailure";return a}return a}(b),t=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a===void 0&&(a="Unknown error code received from WASM binary");a=b.call(this,a)||this;a.name="UnknownErrorCode";return a}return a}(b);g["default"]=a}),98);
__d("mwEBAddDevice",["FBLogger","I64","LSAddDeviceStoredProcedure","LSDataTraceCheckPoint","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","MAWBridgeFireAndForget","MAWTraceUtils","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsRecoveryCodeStatus","Promise","QPLUserFlow","ReQL","isInstamadilloEB","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){var e=a.onFailure,g=a.onInvalidRecoveryCode,k=a.onStart,l=a.onSuccess,m=a.recoveryCode,n=a.storage,o=a.traceId,p=function(){},q=!1;a=new(j||(j=b("Promise")))(function(a,b){c("setTimeout")(function(){if(q)return;var a="Add device failed by timeout 90 sec";c("FBLogger")("labyrinth_web").warn(a);p();e("add_device_timeout");b(a)},9e4)});var r=new j(function(a,q){k(),p=n.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(b,f){if(f.operation==="delete")return;b=[f.value];c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_check_rc_status");d("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){var a="LSEncryptedBackupsRecoveryCodeStatus system error";d("MAWTraceUtils").recordFailureAndFlushForTraceId(o,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],a);p();e("add_device_failed_to_get_rc_status");q(a)},onInvalidRecoveryCode:function(){var a="Invalid recovery code";d("MAWTraceUtils").recordFailureAndFlushForTraceId(o,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],a);p();g();q(a)},onSuccess:function(){d("MAWTraceUtils").recordSuccessAndFlushForTraceId(o,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_INITIALIZE_RESTORE),[]),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_init_restore"),p(),!c("isInstamadilloEB")()?(d("MAWBridgeFireAndForget").fireAndForget("backend","checkForDecryptionFailuresToPointRestore"),d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:n,onFailure:e,onSuccess:l})):(c("QPLUserFlow").endSuccess(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent),l()),a()},recoveryCodeStatusData:b})}),c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(n.tables.encrypted_backups)).then(function(a){var e=a==null?void 0:a.backupId;if(e!=null){var g=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(g==="")return(j||(j=b("Promise"))).reject("deviceRegistrationId is not defined");c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_lsadddevice_sproc");return n.runInTransaction(function(a){return c("LSAddDeviceStoredProcedure")(c("LSFactory")(a),{backupId:e,backupTenancy:(i||(i=d("I64"))).of_int32(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),deviceRegistrationId:g,recoveryCode:m})},"readwrite",void 0,void 0,f.id+":160")}else return(j||(j=b("Promise"))).reject("backupId is not defined")})["catch"](function(a){var b="Add device failed. encrypted_backups table or LSAddDevice sproc";c("FBLogger")("labyrinth_web").catching(a).mustfix(b);d("MAWTraceUtils").recordFailureAndFlushForTraceId(o,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Add Device Failure");p();e("add_device_error");q(b)}))});return j.race([r,a]).then(function(){q=!0})}g["default"]=a}),98);
__d("vestaBackupSecretRestore",["Promise","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("E2EEBackupSecretRestoreModule").__setRef("vestaBackupSecretRestore"),j=c("requireDeferred")("VestaServerGraphQLLoginProvider").__setRef("vestaBackupSecretRestore");function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.input;a=a.environment;var d=(yield (h||(h=b("Promise"))).all([j.load(),i.load()])),e=d[0],f=e.beginLogin,g=e.finishLogin;e=e.initLogin;d=d[1].restoreBackupSecret;return d({beginLogin:f,finishLogin:g,initLogin:e},c,{environment:a})});return k.apply(this,arguments)}g["default"]=a}),98);
__d("mwEBGetPINSecretFromVesta",["CometRelay","E2EEBackupCommon","FBLogger","LSDataTraceCheckPoint","LSDataTraceType","LSIntEnum","MAWTraceUtils","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSettingsDialogQuery.graphql","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","QPLUserFlow","asyncToGeneratorRuntime","gkx","promiseDone","vestaBackupSecretRestore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.addDevice,e=a.clientID,f=a.environment,g=a.getSourceFromContext,i=a.onSubmitPin,j=a.onSubmitPinFailure,k=a.onVestaSecretFetch,l=a.pinCode,m=a.setIsInProgress,n=a.setIsPinCodeIncorrect,o=a.setIsVestaError;a=a.startFlow;var p=d("MAWTraceUtils").startNewTrace((h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").SAP_VESTA_LOGIN),d("MAWTraceUtils").CONTEXT_VESTA_LOGIN);m(!0);i==null?void 0:i();i=g();c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"pin_code",source:i}});g=new TextDecoder();var q;a({additionalAnnotations:{device_type:"HSM"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH});try{c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"vesta_login_begin"),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"PIN_CODE_RESTORE_SUBMIT"),d("MAWTraceUtils").recordCheckpointForTrace(p,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_CALLING_VESTA_LOGIN),[],!1),q=g.decode(yield c("vestaBackupSecretRestore")({environment:f,input:{clientId:e,productUseCase:c("gkx")("24066")?"IGD_ENC_BACKUP":"MSGR_ENC_BACKUP",vestaAccountPin:l}})),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"vesta_login_success"),d("MAWTraceUtils").recordCheckpointForTrace(p,h.ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_LOGIN_COMPLETION),[],!1)}catch(a){j==null?void 0:j();c("promiseDone")(d("CometRelay").fetchQuery(f,c("MWChatEncryptedBackupsSettingsDialogQuery.graphql"),{}).toPromise());if(a.errorType===d("E2EEBackupCommon").BackupErrorType.INVALID_PASSWORD)m(!1),n(!0),d("MWChatEncryptedBackupsLogging").endFailure({errorName:"incorrect_pin_code",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityKey:c("MWEBODSEntityKey.enum").INCORRECT_PIN_CODE,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH}),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"incorrect_pin_code"),d("MAWTraceUtils").recordFailureAndFlushForTraceId(p,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Incorrect pin code");else{d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorMessage:a.message,errorType:a.errorType}},errorName:"vesta_login_failure",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH});c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"pin_code_error");m(!1);o(!0);i="Error when restoring using PIN: "+a;c("FBLogger")("labyrinth_web").mustfix(i);d("MAWTraceUtils").recordFailureAndFlushForTraceId(p,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],a.toString())}throw a}q!=null&&(d("MAWTraceUtils").recordCheckpointForTrace(p,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_ADD_DEVICE),[],!1),k==null?void 0:k(),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_begin"),b(q,p,l))});return i.apply(this,arguments)}g["default"]=a}),98);
__d("updateUpsellsStateInRelayStore",["CometRelay","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.environment,e=a.updateValue;d("CometRelay").commitLocalUpdate(b,function(a){a=a.getRoot().getLinkedRecord("viewer");if(a==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][upsells] A viewer record does not exist when updating upsell state.");return}a.setValue(e,"is_eb_restore_upsells_dismissed")})}g["default"]=a}),98);